<!-- app/views/documents/index.html.erb -->
<div class="container py-4">
  <div class="d-flex flex-wrap justify-content-between align-items-start gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">Documentos de <%= @data_collection.name %></h1>
      <p class="text-muted mb-0">Archivos compartidos durante la toma de datos.</p>
    </div>
    <div class="d-flex flex-wrap gap-2">
      <%= link_to 'Ver conversación', risk_assistant_path(@data_collection), class: 'btn btn-outline-primary' %>
      <%= link_to 'Volver a tomas de datos', data_collections_path, class: 'btn btn-outline-secondary' %>
    </div>
  </div>

  <% if notice %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>
  <% if alert %>
    <div class="alert alert-danger"><%= alert %></div>
  <% end %>

  <% if @documents.any? %>
    <div class="row text-center fw-semibold border-bottom pb-2 mb-3">
      <div class="col-md-6 text-start">Documento</div>
      <div class="col-md-2">Fecha</div>
      <div class="col-md-2">Tamaño</div>
      <div class="col-md-2">Acciones</div>
    </div>

    <% @documents.each do |document| %>
      <div class="row align-items-center py-2 border-bottom">
        <div class="col-md-6 text-start">
          <%= link_to document.filename.to_s,
                      url_for(document),
                      target: '_blank',
                      rel: 'noopener',
                      class: 'text-decoration-none' %>
        </div>
        <div class="col-md-2 text-center">
          <%= l document.created_at, format: :short %>
        </div>
        <div class="col-md-2 text-center">
          <%= number_to_human_size(document.blob.byte_size) %>
        </div>
        <div class="col-md-2 text-center">
          <div class="btn-group" role="group">
            <%= link_to 'Descargar',
                        rails_blob_path(document, disposition: 'attachment'),
                        class: 'btn btn-outline-primary btn-sm' %>
            <%= link_to 'Eliminar',
                        file_risk_assistant_path(@data_collection, document),
                        data: { turbo_method: :delete, turbo_confirm: '¿Estás seguro de eliminar este documento?' },
                        class: 'btn btn-outline-danger btn-sm' %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="text-center py-5 border rounded bg-light-subtle">
      <p class="mb-2 fw-semibold">No hay documentos cargados todavía.</p>
      <p class="mb-0 text-muted">Sube archivos desde la conversación de la toma de datos para verlos aquí.</p>
    </div>
  <% end %>
</div>