<nav class="sidebar-nav">
  <ul class="nav flex-column">
    <li class="nav-item">
      <%= link_to summary_risk_assistant_path(risk_assistant), class: "nav-link d-flex align-items-center gap-2" do %>
        <i class="bi bi-clipboard-data"></i>
        <span>Resumen</span>
      <% end %>
    </li>
    <li class="nav-item mt-2">
      <span class="nav-link d-flex align-items-center gap-2">
        <i class="bi bi-folder"></i>
        <span>Archivos</span>
      </span>
      <% if risk_assistant.uploaded_files.attached? %>
        <ul class="nav flex-column ms-3 mt-1">
              <% @risk_assistant.uploaded_files.each do |file| %>
                <div class="card uploaded-file-card mb-2">
                  <div class="card-body d-flex justify-content-between align-items-center">
                    <div class="file-info d-flex align-items-center">
                      <i class="bi <%= file_icon_for(file) %> file-icon me-2"></i>
                      <%= link_to file.filename.to_s,
                                  url_for(file),
                                  target: "_blank",
                                  class: "file-name text-decoration-none" %>
                      <small class="text-muted ms-2">(<%= number_to_human_size(file.byte_size) %>)</small>
                    </div>
                    <div class="file-actions">
                      <%= link_to rails_blob_path(file, disposition: "attachment"),
                                  class: "btn btn-sm btn-outline-primary me-1",
                                  title: "Descargar" do %>
                        <i class="bi bi-download"></i>
                      <% end %>
                      <%= link_to file_risk_assistant_path(@risk_assistant, file),
                                  data: { turbo_method: :delete, turbo_confirm: "Â¿Eliminar archivo?" },
                                  class: "btn btn-sm btn-outline-danger",
                                  title: "Eliminar" do %>
                        <i class="bi bi-trash"></i>
                      <% end %>
                    </div>
                  </div>
                </div>
              <% end %>
        </ul>
      <% else %>
        <p class="text-muted small ms-3">No hay archivos subidos.</p>
      <% end %>
    </li>
    <li class="nav-item mt-2">
      <%= link_to risk_assistant_resume_path(risk_assistant), class: "nav-link d-flex align-items-center gap-2" do %>
        <i class="bi bi-graph-up"></i>
        <span>Progreso</span>
      <% end %>
      <div class="mt-2 ms-3">
        <%= render partial: "sidebar",
                   locals: {
                     sections: sections,
                     progress_by_section: progress_by_section,
                     overall_pct: overall_pct,
                     risk_assistant: risk_assistant
                   } %>
      </div>
    </li>
  </ul>
</nav>